apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "soc4kafka.fullname" . }}-config
  labels:
    {{- include "soc4kafka.labels" . | nindent 4 }}
data:
  config.yaml: |
    # SOC4Kafka collector config - generated by Helm
    extensions:
      health_check:
        endpoint: 0.0.0.0:13133
    receivers:
      kafka:
        brokers: [{{ .Values.kafka.brokers | quote }}]
        logs:
          topics:
            {{- toYaml .Values.kafka.topics | nindent 10 }}
          encoding: {{ .Values.kafka.encoding | quote }}
    processors:
      resourcedetection:
        detectors: ["system"]
        system:
          hostname_sources: ["os"]
      batch:
    exporters:
      splunk_hec:
        token: ${SPLUNK_HEC_TOKEN}
        endpoint: {{ .Values.splunk.hec.endpoint | quote }}
        source: {{ .Values.splunk.hec.source | quote }}
        sourcetype: {{ .Values.splunk.hec.sourcetype | quote }}
        index: {{ .Values.splunk.hec.index | quote }}
        tls:
          insecure_skip_verify: {{ .Values.splunk.hec.insecureSkipVerify }}
        headers:
          "__splunk_app_name": "soc4kafka"
    service:
      extensions: [health_check]
      pipelines:
        logs:
          receivers: [kafka]
          processors: [batch, resourcedetection]
          exporters: [splunk_hec]
