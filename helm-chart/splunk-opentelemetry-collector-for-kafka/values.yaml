# Default values for splunk-opentelemetry-collector-for-kafka.
# Deploy on MicroK8s or any Kubernetes cluster with: helm install soc4kafka . -f my-values.yaml

# Collector image (Splunk OTel Collector - same distribution as SOC4Kafka binary)
image:
  repository: quay.io/signalfx/splunk-otel-collector
  tag: "0.143.0"
  pullPolicy: IfNotPresent

# Replica count for the collector deployment
replicaCount: 1

# =============================================================================
# SIMPLE MODE - Most users configure only this section
# =============================================================================

# Define multiple Kafka receivers easily
kafkaReceivers:
  - name: main
    brokers:
      - "kafka-broker-1:9092"
      - "kafka-broker-2:9092"
    topics:
      - "application-logs"
    encoding: utf-8
    consumerGroup: "soc4kafka-main"

# Define multiple Splunk HEC exporters easily
splunkExporters:
  - name: primary
    endpoint: "https://splunk-hec:8088/services/collector"
    token: "${SPLUNK_HEC_TOKEN}"
    source: "soc4kafka"
    sourcetype: "otel:logs"
    index: "main"
    insecureSkipVerify: false

# Define pipelines - maps receivers to exporters
pipelines:
  - name: logs
    receivers:
      - main
    exporters:
      - primary
    processors:
      - batch
      - resourcedetection

# =============================================================================
# COMPONENT DEFAULTS - Users can modify these
# =============================================================================

defaults:
  extensions:
    health_check:
      endpoint: "0.0.0.0:13133"

  receivers:
    kafka:
      encoding: utf-8
      initial_offset: latest

  processors:
    batch:
      timeout: 5s
      send_batch_size: 1000
    resourcedetection:
      detectors: ["system"]
      system:
        hostname_sources: ["os"]

  exporters:
    splunk_hec:
      tls:
        insecure_skip_verify: false
      headers:
        __splunk_app_name: "soc4kafka"

# =============================================================================
# ADVANCED MODE - Full override capability
# =============================================================================

# Advanced users can provide raw OTel config that merges over everything
configOverride: {}

# Use an existing secret for the HEC token instead of creating one from values.
# Secret must contain key "splunk-hec-token".
existingSecret: ""
# existingSecret: "my-splunk-hec-secret"

# Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

# Container security context (image runs as splunk-otel-collector uid 999)
securityContext:
  runAsNonRoot: true
  runAsUser: 999
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop: ["ALL"]

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 999
  fsGroup: 999

# Service account
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Pod annotations and labels
podAnnotations: {}
podLabels: {}

# Node selector / tolerations for scheduling (e.g. MicroK8s nodes)
nodeSelector: {}
tolerations: []
affinity: {}

# Extra environment variables for the collector container
extraEnv: []
# extraEnv:
#   - name: OTEL_LOG_LEVEL
#     value: "debug"

# Liveness and readiness probes
livenessProbe:
  httpGet:
    path: /
    port: 13133
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
readinessProbe:
  httpGet:
    path: /
    port: 13133
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5

# Enable persistence for collector state (optional - not required for basic Kafka consumer)
persistence:
  enabled: false
  # storageClass: ""  # Use cluster default
  # size: 1Gi

# Horizontal Pod Autoscaler (disable to use fixed replicaCount)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
