# Default values for splunk-opentelemetry-collector-for-kafka.
# Deploy on MicroK8s or any Kubernetes cluster with: helm install soc4kafka . -f my-values.yaml

# Collector image (Splunk OTel Collector - same distribution as SOC4Kafka binary)
image:
  repository: quay.io/signalfx/splunk-otel-collector
  tag: "0.143.0"
  pullPolicy: IfNotPresent

# Replica count for the collector deployment
replicaCount: 1

# =============================================================================
# SIMPLE MODE - Most users configure only this section
# =============================================================================

# Define multiple Kafka receivers easily
kafkaReceivers:
  - name: main
    brokers:
      - "kafka-broker-1:9092"
      - "kafka-broker-2:9092"
    topics:
      - "application-logs"
    encoding: text
    group_id: "soc4kafka-main"

# Define multiple Splunk HEC exporters easily
splunkExporters:
  - name: primary
    endpoint: "https://splunk-hec:8088/services/collector"
    token: "${SPLUNK_HEC_TOKEN}"
    source: "soc4kafka"
    sourcetype: "otel:logs"
    index: "main"
    tls:
      insecure_skip_verify: false

# Define pipelines - maps receivers to exporters
pipelines:
  - name: 1
    type: logs
    receivers:
      - main
    exporters:
      - primary
    processors:
      - batch
      - resourcedetection

# =============================================================================
# COMPONENT DEFAULTS - Users can modify these
# =============================================================================

defaults:
  extensions:
    health_check:
      endpoint: "0.0.0.0:13133"

  receivers:
    kafka:
      encoding: text

  processors:
    batch:
      timeout: 5s
      send_batch_size: 1000
    resourcedetection:
      detectors: ["system"]
      system:
        hostname_sources: ["os"]

  exporters:
    splunk_hec:
      tls:
        insecure_skip_verify: false
      splunk_app_name: "soc4kafka"

# =============================================================================
# ADVANCED MODE - Full override capability
# =============================================================================

# Advanced users can provide raw OTel config that merges over everything
configOverride: {}

# Use an existing secret for the HEC token instead of creating one from values.
# Secret must contain key "splunk-hec-token".
existingSecret: ""
# existingSecret: "my-splunk-hec-secret"

# Resource limits and requests
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 100m
    memory: 256Mi

# Container security context (image runs as splunk-otel-collector uid 999)
securityContext:
  runAsNonRoot: true
  runAsUser: 999
  allowPrivilegeEscalation: false
  readOnlyRootFilesystem: false
  capabilities:
    drop: ["ALL"]

# Pod security context
podSecurityContext:
  runAsNonRoot: true
  runAsUser: 999
  fsGroup: 999

# Service account
serviceAccount:
  create: true
  name: ""
  annotations: {}

# Pod annotations and labels
podAnnotations: {}
podLabels: {}

# Deployment strategy
strategy:
  type: RollingUpdate
  rollingUpdate:
    maxSurge: 25%
    maxUnavailable: 25%

# Termination grace period (important for Kafka consumers to commit offsets gracefully)
terminationGracePeriodSeconds: 30

# Node selector / tolerations for scheduling (e.g. MicroK8s nodes)
nodeSelector: {}
tolerations: []
affinity: {}

# Extra environment variables for the collector container
extraEnv: []
# extraEnv:
#   - name: OTEL_LOG_LEVEL
#     value: "debug"

# Service configuration (optional - probes work without it, but useful for monitoring/debugging)
service:
  enabled: true  # Set to false if you don't need external access to health endpoint
  type: ClusterIP
  port: 13133

# Liveness, readiness, and startup probes
livenessProbe:
  httpGet:
    path: /
    port: 13133
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
readinessProbe:
  httpGet:
    path: /
    port: 13133
  initialDelaySeconds: 5
  periodSeconds: 10
  timeoutSeconds: 5
startupProbe:
  httpGet:
    path: /
    port: 13133
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 30

# Image pull secrets for private registries
imagePullSecrets: []
# imagePullSecrets:
#   - name: regcred

# Enable persistence for collector state (optional - not required for basic Kafka consumer)
persistence:
  enabled: false
  # storageClass: ""  # Use cluster default
  size: 1Gi  # Required when persistence.enabled is true

# Horizontal Pod Autoscaler (disable to use fixed replicaCount)
autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 10
  targetCPUUtilizationPercentage: 70
  targetMemoryUtilizationPercentage: 80

# Pod Disruption Budget for high availability
podDisruptionBudget:
  enabled: false
  minAvailable: 1
  # maxUnavailable: 1  # Alternative to minAvailable